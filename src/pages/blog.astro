---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';

const posts = await getCollection('blog');

// Sort posts newest first
posts.sort((a, b) => new Date(b.data.publishDate) - new Date(a.data.publishDate));
---

<BaseLayout title="Top Water Angler Blog" description="Catch the latest fishing tips, gear reviews, and adventure stories.">

  <!-- Featured Post -->
  {posts.length > 0 && (
    <section class="featured-post">
      <div class="card featured">
        <img 
          src={posts[0].data.image || "https://source.unsplash.com/900x350/?fishing"} 
          alt={posts[0].data.title} 
        />
        <div class="card-content">
          <h2>
            <a href={`${import.meta.env.BASE_URL}blog/${posts[0].slug}/`}>
              {posts[0].data.title}
            </a>
          </h2>
          <p class="date">
            {new Date(posts[0].data.publishDate).toLocaleDateString('en-US', {
              year: 'numeric',
              month: 'long',
              day: 'numeric'
            })}
          </p>
          <p class="description">{posts[0].data.description}</p>
          <a 
            class="read-more" 
            href={`${import.meta.env.BASE_URL}blog/${posts[0].slug}/`}
            aria-label={`Read more about ${posts[0].data.title}`}
          >
            Read More →
          </a>
        </div>
      </div>
    </section>
  )}

  <!-- Grid of other posts -->
  <section class="post-grid">
    {posts.slice(1).map(post => (
      <div class="card">
        <img 
          src={post.data.image || "https://source.unsplash.com/600x400/?fishing"} 
          alt={post.data.title} 
        />
        <div class="card-content">
          <h3>
            <a href={`${import.meta.env.BASE_URL}blog/${post.slug}/`}>
              {post.data.title}
            </a>
          </h3>
          <p class="date">
            {new Date(post.data.publishDate).toLocaleDateString('en-US', {
              year: 'numeric',
              month: 'long',
              day: 'numeric'
            })}
          </p>
          <p class="description">{post.data.description}</p>
          <a 
            class="read-more" 
            href={`${import.meta.env.BASE_URL}blog/${post.slug}/`}
            aria-label={`Read more about ${post.data.title}`}
          >
            Read More →
          </a>
        </div>
      </div>
    ))}
  </section>

</BaseLayout>
