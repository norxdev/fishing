---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

// Get all blog posts
const posts = await getCollection('blog');

// Sort newest first
const sortedPosts = posts
  .filter(post => !post.data.draft)
  .sort(
    (a, b) =>
      new Date(b.data.publishDate).getTime() -
      new Date(a.data.publishDate).getTime()
  );

// Homepage sections
const featured = sortedPosts.slice(0, 1);
const latest = sortedPosts.slice(1, 5);
---

<BaseLayout
  title="Top Water Angler"
  description="Seasonal bass fishing tactics, gear breakdowns, and real-world angling advice."
>
  <!-- HERO -->
  <section class="hero">
    <div class="hero-content">
      <h1>Top Water Angler</h1>
      <p>
        Seasonal fishing tactics, gear breakdowns, and real-world advice
        for anglers who want to catch more fish — not just read about it.
      </p>
      <a href={`${import.meta.env.BASE_URL}blog`} class="btn-primary">
        Read the Blog
      </a>
    </div>
  </section>

  <!-- FEATURED POST -->
  {featured.length > 0 && (
    <section class="featured">
      <h2>Featured</h2>

      <article class="featured-card">
        <img
          src={featured[0].data.image}
          alt={featured[0].data.title}
          loading="lazy"
        />
        <div class="featured-content">
          <h3>{featured[0].data.title}</h3>
          <p>{featured[0].data.description}</p>
          <a
            href={`${import.meta.env.BASE_URL}blog/${featured[0].slug}/`}
            class="read-more"
          >
            Read Article →
          </a>
        </div>
      </article>
    </section>
  )}

  <!-- LATEST POSTS -->
  <section class="latest">
    <h2>Latest Articles</h2>

    <div class="card-grid">
      {latest.map(post => (
        <article class="post-card">
          <img
            src={post.data.image}
            alt={post.data.title}
            loading="lazy"
          />
          <div class="card-body">
            <h3>{post.data.title}</h3>
            <p>{post.data.description}</p>
            <a
              href={`${import.meta.env.BASE_URL}blog/${post.slug}/`}
              class="read-more"
            >
              Read →
            </a>
          </div>
        </article>
      ))}
    </div>

    <div class="view-all">
      <a href={`${import.meta.env.BASE_URL}blog`}>
        View all articles →
      </a>
    </div>
  </section>
</BaseLayout>
